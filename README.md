# Google Docs to WordPress 入稿ツール

Google Docs で作成した記事を、ボタン一つで WordPress に下書きとして送信できるツール（Google Apps Script）です。
エンジニアでない方でも、このコードを Google Docs にコピー＆ペーストするだけで簡単に利用できます。

## ✨ 機能概要

- **記事の自動変換**: Google Docs の見た目（見出し、太字、リストなど）をそのまま WordPress のブロック形式に変換します。
- **画像の自動アップロード**: ドキュメント内の画像を自動で WordPress にアップロードし、記事内に配置します。
- **メタデータ設定**: 記事のタイトル、スラッグ、投稿日時、抜粋、カテゴリ、タグ、アイキャッチ画像を Google Docs 上で設定できます。
- **目次自動生成**: 記事の見出し（h2-h4）から目次を自動生成し、記事冒頭に挿入します。

---

# 導入手順（インストール）

GitHubのコードをあなたの GoogleDocs に導入する手順です。
※ 所要時間: 約 5〜10分

### 準備するもの
- 紐づけたい WordPress サイト
- WordPress の管理者アカウント（アプリケーションパスワード発行用）

## Step 1. Google Doc を用意する
1. 記事執筆用の Google Doc を新規作成します（タイトルは「ブログ執筆用テンプレート」などにしておくと便利です）。
2. メニューの **「拡張機能」** > **「Apps Script」** をクリックします。
   - 別のタブでスクリプトエディタが開きます。

## Step 2. ファイルを作成してコードをコピペする
スクリプトエディタには最初 `コード.gs` というファイルがありますが、これは削除するか、名前を変更して使います。
以下のファイル名でスクリプトファイル・HTMLファイルを作成し、GitHub上の同名ファイルの中身をすべてコピー＆ペーストしてください。

| ファイル名 | 種類 | GitHub上のファイル | 説明 |
|---|---|---|---|
| **App.gs** | スクリプト | [App.gs](./App.gs) | メイン処理 |
| **Config.gs** | スクリプト | [Config.gs](./Config.gs) | 設定・定数 |
| **DocParser.gs** | スクリプト | [DocParser.gs](./DocParser.gs) | ドキュメント解析ロジック |
| **WpClient.gs** | スクリプト | [WpClient.gs](./WpClient.gs) | WordPress通信処理 |
| **Utils.gs** | スクリプト | [Utils.gs](./Utils.gs) | 便利機能 |
| **Sidebar.html** | **HTML** | [Sidebar.html](./Sidebar.html) | サイドバー画面 |

**ポイント:**
- ファイルを追加するには、エディタ左上の「＋」ボタンから「スクリプト」または「HTML」を選びます。
- `Sidebar.html` だけは「HTML」を選んで作成してください。その他は「スクリプト」です。

## Step 3. 初回設定（WordPressとの連携）
1. Google Doc の画面に戻り、ブラウザをリロード（再読み込み）します。
2. 数秒待つと、メニューの右側に **「WordPress入稿」** というメニューが増えます。
   - ※表示されない場合は、スクリプトエディタで `App.gs` の `onOpen` 関数を実行してみてください。
3. **「WordPress入稿」** > **「設定」** をクリックします。
4. 初回のみ「権限の承認」が必要です。画面の指示に従って許可してください。
   - 「このアプリはGoogleによって確認されていません」と出た場合: 「詳細」→「(プロジェクト名)に移動(安全ではないページ)」→「許可」と進んでください。
5. 入力プロンプトが表示されるので、以下の情報を入力します。
   - **サイトURL**: `https://your-site.com` (末尾のスラッシュは不要)
   - **ユーザー名**: WordPressのログインID
   - **アプリケーションパスワード**: 
     - WordPress管理画面「ユーザー」>「プロフィール」の下の方にある「アプリケーションパスワード」で新しいパスワードを作成し、それを入力します。（通常のログインパスワードではありません。）

これで準備完了です！🎉

---

# 📖 利用マニュアル（執筆〜入稿）

## 1. 記事の準備

セットアップした Google Doc をコピーして（またはそのファイルでそのまま）、記事を執筆します。

### メタデータの設定
ドキュメントの**2行目**に、設定用の表（テーブル）を作成すると、記事の詳細情報を指定できます。
表は2列で作成し、左側に項目名、右側に値を入力します。
（「WordPress入稿」メニューの「カテゴリ・タグ設定」を使うと、この表の一部を自動入力できます）

| 項目名 (Key) | 設定値 (Value) | 備考 |
|---|---|---|
| **Title** | 記事のタイトル | 空欄の場合、ドキュメント名が使われます |
| **Slug** | my-article-slug | URLの一部になります (英数字とハイフン) |
| **Date** | 2025-01-01 10:00 | 公開予約日時 |
| **Excerpt** | 記事の抜粋文 | 検索結果などに表示される概要 |
| **Category** | ニュース, コラム | カンマ区切りで複数指定可 |
| **Tag** | 新商品, 行事 | カンマ区切りで複数指定可 |
| **Featured Image** | [画像を貼り付け] | インライン画像、または「テキストの折り返し」画像に対応 |

※ この表は、WordPressへの入稿時には**本文から削除**されます。

## 2. カテゴリとタグの設定（簡単モード）
1. メニューの「**WordPress入稿**」 > 「**カテゴリ・タグ設定**」をクリックします。
2. サイドバーが表示され、WordPressに登録されているカテゴリとタグの一覧が読み込まれます。
3. チェックボックスで選択し、「**設定をドキュメントに保存**」ボタンを押します。
4. ドキュメント冒頭のメタデータ表に、選択したカテゴリ・タグが自動的に記入されます。

## 3. 会話吹き出しの作り方
「インタビュー記事」や「Q&A」などでよく使う吹き出し機能は、**「2列の表（テーブル）」** を作成することで実現できます。

1. **2列の表** を挿入します（行数は自由）。
2. **左側のセル**: アイコン画像（または名前）を入れます。
3. **右側のセル**: 吹き出しの中身（セリフ）を書きます。

これだけで、WordPress上では自動的に「会話ブロック」として変換されます。
※見た目の調整（枠線を消す、アイコンを丸くするなど）は、テーマを直接編集するか、外観＞カスタマイズで追加CSSを編集して行ってください。

## 4. WordPressへの入稿
書き終わったら、メニューの「**WordPress入稿**」 > 「**下書きとして投稿**」をクリックします。
処理が完了すると、「投稿完了」のメッセージと共に、作成された記事のIDが表示されます。

---

# 🎨 カスタマイズ（目次などのデザイン）

生成される目次（TOC）などのデザインを調整したい場合、WordPressの「外観」>「カスタマイズ」>「追加CSS」に以下のコードを追加してください。以下のコードは、目次のデザインを追加するもっともシンプルな一例です。

```css
/* 目次全体のコンテナ */
.toc-container {
    background: #f9f9f9;
    padding: 1em 1.5em;
    border: 1px solid #ddd;
    margin-bottom: 2em;
}

/* 目次のタイトル */
.toc-title {
    font-weight: bold;
    margin-bottom: 0.5em;
    font-size: 1.1em;
}

/* リストアイテムのスタイル */
.toc-container ul {
    list-style: none; /* 点を消す */
    padding-left: 0;
}

.toc-container li {
    margin-bottom: 0.5em;
}

/* 階層ごとのインデント */
.toc-level-3 {
    margin-left: 1.5em; /* 見出し3は少し右へ */
}

.toc-level-4 {
    margin-left: 3em; /* 見出し4はさらに右へ */
}
```

---

# 🛠 開発者向け情報 (Developer Reference)

このツールをカスタマイズしたり、テーマ開発を行うエンジニア向けの詳細情報です。

## 📁 プロジェクト構成

このプロジェクトは Google Apps Script (GAS) で構築されています。

| ファイル | 役割・詳細 |
|---|---|
| **App.gs** | **メインコントローラー**。メニューの作成、サイドバーの表示、メイン処理フロー (`postAsDraft`) を制御します。 |
| **DocParser.gs** | **パーサー**。Google Doc の要素（Paragraph, Table, Image等）を走査し、HTML文字列に変換します。目次の生成もここで行います。 |
| **WpClient.gs** | **APIクライアント**。WordPress REST API (`/wp-json/wp/v2/`) との通信を担当します（投稿作成、メディアアップロード、タグ取得など）。 |
| **Config.gs** | **設定ファイル**。WordPress接続設定の取得ロジックや、生成するHTMLの **CSSクラス名定義** がここに集約されています。 |
| **Utils.gs** | 汎用ユーティリティ（HTMLエスケープ、MIMEタイプ判定、ログ出力など）。 |
| **Sidebar.html** | カテゴリ・タグ選択用のサイドバー画面（HTML/CSS/Client-side JS）。 |

## 🎨 テーマ開発者向け: 生成されるHTMLとCSS

本ツールが生成するHTMLは、可能な限り WordPress のブロックエディタ (Gutenberg) と互換性を持つように設計されています。
テーマ側で以下のクラスに対してスタイルを定義することで、表示をコントロールできます。

### 1. 目次 (Table of Contents)
記事の冒頭に自動挿入されます。

**HTML構造例:**
```html
<div class="toc-container">
  <p class="toc-title">目次</p>
  <ul>
    <li class="toc-level-2"><a href="#toc-heading-1">見出しテキスト</a></li>
    <li class="toc-level-3"><a href="#toc-heading-2">小見出しテキスト</a></li>
  </ul>
</div>
```

**クラス一覧:**
| 要素 | クラス名 | 説明 |
|---|---|---|
| `div` | `.toc-container` | 目次全体を囲むラッパー要素 |
| `p` | `.toc-title` | タイトルラベル（デフォルト: "目次"） |
| `li` | `.toc-level-2` | H2見出しへのリンク |
| `li` | `.toc-level-3` | H3見出しへのリンク |
| `li` | `.toc-level-4` | H4見出しへのリンク |

### 2. 会話吹き出し (Chat Bubbles)
2列のテーブルが自動的に変換されます。

**HTML構造例:**
```html
<div class="chat-block">
  <div class="chat-row">
    <div class="chat-icon"><img ...></div>
    <div class="chat-bubble"><p>こんにちは！</p></div>
  </div>
</div>
```

**クラス一覧:**
| 要素 | クラス名 | 説明 |
|---|---|---|
| `div` | `.chat-block` | 会話ブロック全体 |
| `div` | `.chat-row` | 会話の1行（アイコン+吹き出し） |
| `div` | `.chat-icon` | アイコンエリア（左側） |
| `div` | `.chat-bubble` | 吹き出しエリア（右側） |

### 3. 見出し (Headings)
記事内の見出しには、自動的にIDが付与されます（目次からのアンカーリンク用）。

**HTML構造例:**
```html
<h2 class="wp-block-heading" id="toc-heading-1">見出しテキスト</h2>
```

### 3. 画像 (Images)
画像は一度プレースホルダーとして処理され、アップロード完了後に以下のようなHTMLに置換されます。
WordPress の「画像ブロック」と同様の構造です。

**HTML構造例:**
```html
<figure class="wp-block-image size-large">
  <img src="https://..." alt="alt text" class="wp-image-123" />
</figure>
```

## 🔧 カスタマイズガイド

### CSSクラスの変更
生成されるHTMLのクラス名は、コードを直接書き換えなくても `Config.gs` で変更可能です。

**Config.gs:**
```javascript
  // HTML生成用CSSクラス定義
  CLASSES: {
    H2: 'wp-block-heading', // 見出しのクラス
    // ...
    IMAGE_FIGURE: 'wp-block-image size-large', // 画像のラッパークラス
  }
```

### 新しい要素への対応
`DocParser.gs` の `_processElement` メソッドを拡張することで、独自の変換ロジックを追加できます。
例えば、特定の背景色付きのテーブルを「会話吹き出しブロック」に変換する、といったカスタマイズが可能です。

---

## ライセンス
MIT License

# テスト計画書

## 1. 単体テスト

### DocParser

| テストケース | 入力 | 期待出力 |
|-------------|------|----------|
| 見出し1変換 | 見出し1スタイルの段落 | `<h2>テキスト</h2>` |
| 見出し2変換 | 見出し2スタイルの段落 | `<h3>テキスト</h3>` |
| 見出し3変換 | 見出し3スタイルの段落 | `<h4>テキスト</h4>` |
| 通常段落変換 | 標準テキスト | `<p>テキスト</p>` |
| 太字変換 | 太字テキスト | `<strong>テキスト</strong>` |
| 斜体変換 | 斜体テキスト | `<em>テキスト</em>` |
| 複合装飾 | 太字+斜体 | `<strong><em>テキスト</em></strong>` |
| リンク変換 | ハイパーリンク | `<a href="URL">テキスト</a>` |
| 画像プレースホルダー | インライン画像 | `<!-- WP_IMAGE_PLACEHOLDER:0 -->` |
| 会話ブロック判定（真） | 2列テーブル + [L] | true |
| 会話ブロック判定（偽） | 3列テーブル | false |
| 会話ブロック変換 | [L]/[R]テーブル | 適切なdiv構造 |
| HTMLエスケープ | `<script>` | `&lt;script&gt;` |
| 空段落スキップ | 空行 | 空文字列 |

### WpClient

| テストケース | 条件 | 期待結果 |
|-------------|------|----------|
| 認証ヘッダー生成 | user:pass | 正しいBasic認証ヘッダー |
| 成功レスポンスパース | HTTP 200 + JSON | `{success: true, data: {...}}` |
| エラーレスポンスパース | HTTP 400 + WP_Error | `{success: false, error: "message"}` |
| リトライ成功 | 1回目失敗→2回目成功 | 成功結果を返却 |
| リトライ上限到達 | 3回連続失敗 | `{success: false, error: "Max retries"}` |
| カテゴリ検索ヒット | 存在するカテゴリ名 | カテゴリID |
| カテゴリ検索ミス | 存在しないカテゴリ名 | null |

### Config

| テストケース | 条件 | 期待結果 |
|-------------|------|----------|
| 認証情報取得 | PropertiesService設定済み | `{USER, PASS}` |
| 認証情報未設定 | PropertiesService空 | `{null, null}` |

---

## 2. 統合テスト

### 基本フローテスト

| シナリオ | 内容 | 確認項目 |
|---------|------|----------|
| テキストのみ投稿 | 見出し+段落+装飾テキスト | HTML正常生成、投稿成功 |
| 画像1枚付き投稿 | テキスト+画像1枚 | アップロード→URL置換→投稿成功 |
| 画像複数付き投稿 | テキスト+画像3枚 | 順序保持、全画像埋め込み |
| 会話ブロック投稿 | 会話テーブル含む記事 | 正しいHTML構造で投稿 |
| 混在記事投稿 | 全要素含む実践的記事 | 全要素正常変換 |

### エラーハンドリングテスト

| シナリオ | 条件 | 期待動作 |
|---------|------|----------|
| 認証失敗 | 無効な認証情報 | エラーメッセージ表示、処理中断 |
| 画像アップロード失敗 | サーバーエラー | リトライ→スキップ or 中断（設定依存） |
| 投稿失敗 | 権限不足 | エラーメッセージ表示 |
| ネットワークエラー | 接続断 | タイムアウトエラー表示 |

### 境界値テスト

| シナリオ | 条件 | 確認項目 |
|---------|------|----------|
| 空ドキュメント | 内容なし | エラーなく空投稿 or 警告 |
| 大量画像 | 50枚 | 6分以内に完了 |
| 大きい画像 | 5MB | アップロード成功 |
| 長文記事 | 10,000文字 | 正常投稿 |

---

## 3. ドライラン機能

本番投稿前の確認機能。

### 出力項目

| 項目 | 内容 |
|------|------|
| 生成HTML | プレビュー表示 |
| 画像一覧 | ファイル名、サイズ、形式 |
| 推定処理時間 | 画像数に基づく概算 |
| 設定確認 | WP_URL、認証状態 |

### 確認ポイント

- [ ] HTMLが意図通りの構造か
- [ ] 画像がすべて検出されているか
- [ ] 会話ブロックが正しく認識されているか
- [ ] サイズ上限を超える画像がないか

---

## 4. 手動確認項目

WordPress管理画面での確認。

| 項目 | 確認方法 |
|------|----------|
| 記事表示 | 投稿プレビュー画面で見た目確認 |
| 画像表示 | メディアライブラリ登録確認 |
| メタデータ | alt_text、キャプションの反映 |
| ブロック構造 | ブロックエディタで構造確認 |
| レスポンシブ | モバイル表示確認 |

---

## 5. リグレッションテスト

機能追加・修正時に再実行するテスト。

| 対象 | テスト |
|------|--------|
| DocParser変更時 | 全要素変換テスト |
| WpClient変更時 | API通信テスト一式 |
| Config変更時 | 設定読み込みテスト |
| 画像処理変更時 | 画像アップロード・埋め込みテスト |
